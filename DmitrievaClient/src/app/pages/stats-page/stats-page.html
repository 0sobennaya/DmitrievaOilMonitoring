<!-- stats-page.html -->
<div class="stats-container">
  <h1 class="stats-title">Статистика</h1>

  @if (statistics(); as stats) {
    <!-- KPI карточки -->
    <div class="metrics-grid">
      <div class="metric-card">
        <div class="metric-label">Всего масел</div>
        <div class="metric-value">{{ stats.totalOils }}</div>
      </div>
      <div class="metric-card" [style.border-color]="COLOR_MAP['Нормальное'].main">
        <div class="metric-label">Нормальное</div>
        <div class="metric-value">{{ stats.normalOils }}</div>
      </div>
      <div class="metric-card" [style.border-color]="COLOR_MAP['Предельное'].main">
        <div class="metric-label">Требует внимания</div>
        <div class="metric-value">{{ stats.warningOils }}</div>
      </div>
      <div class="metric-card" [style.border-color]="COLOR_MAP['Критическое'].main">
        <div class="metric-label">Средний износ</div>
        <div class="metric-value">{{ stats.averageWear.toFixed(1) }} мг/л</div>
      </div>
      <div class="metric-card accent-purple">
        <div class="metric-label">Среднее загрязнение</div>
        <div class="metric-value">{{ stats.averageContamination.toFixed(1) }} мкм</div>
      </div>
    </div>

    <!-- Диаграмма статуса масел -->
    <div class="chart-section">
      <h2>Распределение масел по состоянию</h2>
      <div class="chart-wrapper">
        <canvas
          baseChart
          type="doughnut"
          [data]="statusChartData()"
          [options]="statusChartOptions">
        </canvas>
      </div>
    </div>
  }

  <!-- Критические масла -->
  <div class="critical-section">
    <h2>Масла в критическом состоянии</h2>
    
    @if (criticalWear().length > 0) {
      <div class="chart-wrapper">
        <canvas
          baseChart
          type="bar"
          [data]="criticalChartData()"
          [options]="criticalChartOptions">
        </canvas>
      </div>
    } @else {
      <div class="empty-state">
        <p>Критических масел не обнаружено</p>
      </div>
    }
  </div>

 <!-- Анализ насосов по статусу масла -->
<div class="pump-health-section">
  <h2>Анализ насосов по состоянию масла</h2>
  
  @if (pumpsHealth() && pumpsHealth().length > 0) {
    <div class="chart-wrapper">
      <canvas #pumpChart class="pump-chart"></canvas>
      
      <!-- Легенда со статусами -->
      <div class="status-legend">
        <div class="legend-item" [style.color]="COLOR_MAP['Критическое'].main">
            <div class="legend-box" [style.background]="COLOR_MAP['Критическое'].main"></div>
            Критическое
          </div>
          <div class="legend-item" [style.color]="COLOR_MAP['Предельное'].main">
            <div class="legend-box" [style.background]="COLOR_MAP['Предельное'].main"></div>
            Предельное
          </div>
          <div class="legend-item" [style.color]="COLOR_MAP['Удовлетворительное'].main">
            <div class="legend-box" [style.background]="COLOR_MAP['Удовлетворительное'].main"></div>
            Удовлетворительное
          </div>
          <div class="legend-item" [style.color]="COLOR_MAP['Нормальное'].main">
            <div class="legend-box" [style.background]="COLOR_MAP['Нормальное'].main"></div>
            Нормальное
          </div>
      </div>
    </div>
  } @else {
    <div class="empty-state">
      <p>Данные по насосам отсутствуют</p>
    </div>
  }
</div>


  <!-- Детали насосов (радарная диаграмма) -->
  <div class="pump-details-section">
    <h2>Насосы с повышенной вибрацией</h2>
    
    <div class="chart-wrapper">
      <canvas #pumpDetailsChart class="radar-chart"></canvas>
    </div>
  </div>
</div>
